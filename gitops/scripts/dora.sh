DC_URL=https://api.cluster-hkmxr.hkmxr.sandbox1323.opentlc.com:6443
DC_UID=admin
DC_PWD=yiroE8TvMHzIgv9L
#DC_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6IkxUeEp5cXdUdnRGOXBvZzdPckxWR1BSVWZMa2N2T2xFRi10eHdIYTF3aVUifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJodWItbnMiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlY3JldC5uYW1lIjoicmhzaS10b2tlbi1qc3I0biIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJyaHNpIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiNDZiMGJkMTgtYTc5Yy00ZTkwLWJlY2MtY2Y4NWQ0MjBmNGZjIiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omh1Yi1uczpyaHNpIn0.QBNsLXWKFs0_AZnAqRMcsqJYTbunQ1AQye6NZ6Vtd9C2s8z87VDRnqbq8MAmwb9q86tCNYu7n2UccB9URWtSIqx3td8KjI59RKv8Ju4BGGa-q943d9RRRNGcYt1EuStv-IaOO-eeFt1gchwUxZOUjMMxcI7Kfmb1nJkvLEzOKq1SHQbFcC8bsWtZgpNedasUNURI-s1QN3Nwn-EpvpBYBL2uk2wyhhz_6PxfMyFbLYmKmIiOHr47a4TVysHviZGdjmFZspZhIIUvq-VzGl3x0RtM3uuzIHQnPvcG0gwvEavjohR1sf6GtbVfwyI2_18WlzCgliQZzS2IDVd8gM2yDpLruunVt-hVUd3jmExMsB8T178NzQVpOJYRC-5EaULUQBCBQ-pTncWiPaMUgP4vvmUVlWUNkIAR2aSWaW0BbL-r579tx9OF1El0BtOt4z7gDotjKr5zAR8t8Ef5_AqCy3cqF18L-XqCnNX67AV_RzSf4ZC5QkvzUCC8xDqmvxVjRtzmjNPIOo6spjJ1t-x7kAccnpSUZe0BP1Xrz83ysrdYMjGClEXjP9AAuNFaWbmJiR2U0Wo1PqyKZN_-9Y5_ca3ObwXUNE9xPOPo5-T_Fua3W74CSSltEwMnqh-iXe0yfSu1oOnfx0JErSS-3loO4K0iDET1a7f9tqaxNDuHrPc
DC_STATUS=on  # on/off

AWS_URL=https://api.cluster-dzn5p.dzn5p.sandbox1120.opentlc.com:6443
AWS_UID=admin
AWS_PWD=3HAuyF33ac4eM0LR
AWS_TOKEN=
AWS_STATUS=on   # on/off

AZURE_URL=https://api.ocp4-7j99r-ipi.azure.opentlc.com:6443
AZURE_UID=admin
AZURE_PWD=VEZjh2CvtKnPsi47
AZURE_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6InhRbmpudFBWZVVIMXNtaFhZMUEya0dCM2JkU2tuUEZJNFZSLWRwaDhaUk0ifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJodWItbnMiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlY3JldC5uYW1lIjoicmhzaS10b2tlbi1nNXFkYyIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJyaHNpIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiNzAzNDA0YTYtMjdlZC00ZGYwLTgyOGItZDIzZjA0YzgyZDFmIiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omh1Yi1uczpyaHNpIn0.avMT7q9nzJH15rk8J4YVuEzbnEpQDAA7cRqhWYEIR_M7k1S5wcqPc0BOfoMBXDV-4ykdesg04AgNYFJ13OgSq27l3g5FPM_nf1CtiExKofv00XdRT2tPI2JVxagRzPfMeJ4ljAQsBZbUkZ6JG6-6XyAQ6Mf3B3UeGlhiPqv56bNW7ed3-27tkzq6R_G2szvRJ0wK_x83ReZjJUFIVHYMRtWU_MVgIM8xUI8_qBP-JBTImpOA6sGW9Gt7uWmUTzmitzhBzXeBfVKxuRmCrFx6B2vLxRDnld_FH6_EYk5_f1Qz5RBqfFeloA_GzF4StVEUnLzPlHwncdiPrj24xiVVt9zYDIhuQhvI3wEwVDGvM2PavRLBDRYuNSdRbhcmkMpMdqcsWSGCvrMunJDqVjEO4jRndOVnOOnulxTEVvfyCbcviaGEMDHNKaDxPU4GtwrqXYREy8NRyYtR6gTTqKqqUrgFNFpOgDfjLCmT45wMW8mhekoWCrUMymcxXKa2Gxp2zbZppPwVJG2EvB44Lfa0YjWoizpIz6Jznf7-YYQEGNMDJqRoLhxMFvuWcdaPtJ5RwkDpnZDyTHjC97HvqfVYJlXPInqKpheO_g5D5357yy8kAEWrNu3X42SXMRidTdlwb20T0DfDutpjmiGomn_wi9m_2W--PkICrUGRDoXARVg
AZURE_STATUS=off

AZURE_NATIVE_STATUS=on

PROJECT=pss

MSG="Welcome to Red Hat Dora Demo"
RESULT=""

# set path to skupper and oc cli
alias skupper=~/Documents/openshift/skupper
alias oc=~/Documents/openshift/oc

declare menu_array
#menu_array=( ["1"]="1) init" ["woof"]="dog")
#menu_array+=(["1"]="1) init")
#menu_array=(["1"]="\033[43m1)\033[0m init")

menu_array["1"]="1) init"
menu_array["2"]="2) init"
menu_array["3"]="3) init"
menu_array["4"]="4) init"
menu_array["5"]="5) bind service"
menu_array["6"]="6) bind service"
menu_array["7"]="7) bind service"
menu_array["8"]="8) bind service"
menu_array["9"]="9) unbind service"
menu_array["10"]="10) unbind service"
menu_array["11"]="11) unbind service"
menu_array["12"]="12) unbind service"

# Function to check if an array contains an item
highlight() {
  return "\033[43m$1\033[0m"
}



print_fixed_line() {
    # Save cursor position
    tput sc

    # Get the terminal height
    rows=$(tput lines)

    # Move cursor to the bottom line
    tput cup $((rows-1)) 0

    # Print the fixed message
    echo "\033[1;37m$MSG.\033[0m"

    # Restore cursor position
    tput rc
}


menu (){
sleep 2s
clear
print_fixed_line
echo "                              ┏   ┏┓        ┓┏  ┓   • ┓  ┏┓┓     ┓   ┓"
echo "           _\|/_             ━┫   ┃┃┏┓┏┓┏┓  ┣┫┓┏┣┓┏┓┓┏┫  ┃ ┃┏┓┓┏┏┫   ┣━"
echo "           (o o)              ┗   ┗┛┣┛┗ ┛┗  ┛┗┗┫┗┛┛ ┗┗┻  ┗┛┗┗┛┗┻┗┻   ┛"
echo " ┏━━━━━━oOO.{-}.OOo━━━━━━━┳━━━━━━━━━┛━━━━━━━━━━┛━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[Capters]━┓"
echo " ┃  ╦═╗╔═╗╔╦╗  ╦ ╦╔═╗╔╦╗  ┃      ╔╦╗╔═╗╦═╗╔═╗       ┃ \033[4m\033[1;37mc1\033[0m Risk Management       \033[4m\033[1;37mc2\033[0m Incident Reports     ┃"
echo " ┃  ╠╦╝║╣  ║║  ╠═╣╠═╣ ║   ┃       ║║║ ║╠╦╝╠═╣       ┃ \033[4m\033[1;37mc3\033[0m Resilience Testing    \033[4m\033[1;37mc4\033[0m Third Party Risk     ┃"
echo " ┃  ╩╚═╚═╝═╩╝  ╩ ╩╩ ╩ ╩   ┃      ═╩╝╚═╝╩╚═╩ ╩       ┃ \033[4m\033[1;37mc5\033[0m Information sharing                           ┃"
echo " ┣━━━━━━━━━━━━━━━━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫"
echo " ┃  ┳┓┏┓                  ┃  ┏┓┓ ┏┏┓                ┃  ┏┓┏┓┳┳┳┓┏┓         ┃  ┏┓┏┓┳┳┳┓┏┓  ┳┓┏┓┏┳┓┳┓┏┏┓  ┃"
echo " ┃  ┃┃┃                   ┃  ┣┫┃┃┃┗┓                ┃  ┣┫┏┛┃┃┣┫┣          ┃  ┣┫┏┛┃┃┣┫┣   ┃┃┣┫ ┃ ┃┃┃┣   ┃"
echo " ┃  ┻┛┗┛                  ┃  ┛┗┗┻┛┗┛                ┃  ┛┗┗┛┗┛┛┗┗┛         ┃  ┛┗┗┛┗┛┛┗┗┛  ┛┗┛┗ ┻ ┻┗┛┗┛  ┃"
echo " ┣━━━━━━━━━━━━━━━━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫"
echo " ┃ ${menu_array[1]}                ┃ ${menu_array[2]}                 ┃ ${menu_array[3]}             ┃ ${menu_array[4]}                    ┃"
echo " ┃ ${menu_array[5]}        ┃ ${menu_array[6]}         ┃ ${menu_array[7]}     ┃ ${menu_array[8]}            ┃"
echo " ┃ ${menu_array[9]}      ┃ ${menu_array[10]}      ┃ ${menu_array[11]}  ┃ ${menu_array[12]}         ┃"
echo " ┣━━━━━━━━━━━━━━━━━━━━━━━━┻━━━━━━━━━━━━━━━━━━━━━━━━━┻━━━━━━━━━━━━━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛"
echo " ┃  [l] Link All        [e] Expose services          [d] Delete all       ┃ $RESULT"
echo " ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛"

}

menu

while true
do
MSG=""
read n
case $n in

"1")
# DC
if [[ $DC_STATUS == "on" ]] 
then
  oc login --server=$DC_URL -u $DC_UID -p $DC_PWD --insecure-skip-tls-verify=true
  oc project $PROJECT
  skupper init --enable-console --enable-flow-collector --console-auth unsecured --site-name dc-site
  skupper token create aws_to_dc.token
  skupper token create azure_to_dc.token
  skupper token create azure_native_to_dc.token
  menu_array["1"]="\033[43m1) init\033[0m"
fi  
;;

"2")
#AWS
if [[ $AWS_STATUS == "on" ]] 
then
  oc login --server=$AWS_URL -u $AWS_UID -p $AWS_PWD --insecure-skip-tls-verify=true
  oc project $PROJECT
  skupper init --enable-console --enable-flow-collector --console-auth unsecured --site-name aws-site
  menu_array["2"]="\033[43m2) init\033[0m"
fi
;;

"3")
#AZURE
if [[ $AZURE_STATUS == "on" ]] 
then
  oc login --server=$AZURE_URL -u $AZURE_UID -p $AZURE_PWD --insecure-skip-tls-verify=true
  oc project $PROJECT
  skupper init --enable-console --enable-flow-collector --console-auth unsecured --site-name azure-site
  menu_array["3"]="\033[43m3) init\033[0m"
fi
;;

"4")
# Azure Native DB
if [[ $AZURE_NATIVE_STATUS == "on" ]]
then
  oc login --server=$DC_URL -u $DC_UID -p $DC_PWD --insecure-skip-tls-verify=true
  oc project azure-native
  skupper init --enable-console --enable-flow-collector --console-auth unsecured --site-name azure-native-site
  menu_array["4"]="\033[43m4) init\033[0m"
fi
;;


"5")
# DC Bind
oc login --server=$DC_URL -u $DC_UID -p $DC_PWD --insecure-skip-tls-verify=true
oc project $PROJECT
#skupper service bind rtgs-apis service rtgs-apis-rhsi
skupper service bind postgresql service postgresqldb
menu_array["5"]="\033[43m5) bind service\033[0m"
menu_array["9"]="9) unbind service"
;;

"6")
# bind service on AWS
oc login --server=$AWS_URL -u $AWS_UID -p $AWS_PWD --insecure-skip-tls-verify=true
oc project $PROJECT
#skupper service bind rtgs-apis service rtgs-apis-rhsi
skupper service bind postgresql service postgresqldb
menu_array["6"]="\033[43m6) bind service\033[0m"
menu_array["10"]="10) unbind service"
;;

"7")
# bind service on Azure
oc login --server=$AZURE_URL -u $AZURE_UID -p $AZURE_PWD --insecure-skip-tls-verify=true
oc project $PROJECT
#skupper service bind rtgs-apis service rtgs-apis-rhsi
skupper service bind postgresql service postgresqldb
menu_array["7"]="\033[43m7) bind service\033[0m"
menu_array["11"]="11) unbind service"
;;

"8")
# bind Azure Native DB
oc login --server=$DC_URL -u $DC_UID -p $DC_PWD --insecure-skip-tls-verify=true
# api from dc
oc project $PROJECT
#skupper service bind rtgs-apis service rtgs-apis-rhsi
# db from Azure native
oc project azure-native
skupper service bind postgresql service azure-postgresql-service
menu_array["8"]="\033[43m8) bind service\033[0m"
menu_array["12"]="12) unbind service"
;;



"9")
# DC unbind
# unbind the service in DC to see the impact
oc login --server=$DC_URL -u $DC_UID -p $DC_PWD --insecure-skip-tls-verify=true
oc project $PROJECT
#skupper service unbind rtgs-apis service rtgs-apis-rhsi
skupper service unbind postgresql service postgresqldb
menu_array["9"]="\033[43m9) unbind service\033[0m"
menu_array["5"]="5) bind service"
;;

"10")
# unbind service on AWS
oc login --server=$AWS_URL -u $AWS_UID -p $AWS_PWD --insecure-skip-tls-verify=true
oc project $PROJECT
#skupper service unbind rtgs-apis service rtgs-apis-rhsi
skupper service unbind postgresql service postgresqldb
menu_array["10"]="\033[43m10) unbind service\033[0m"
menu_array["6"]="6) bind service"
;;

"11")
# unbind service on Azure
oc login --server=$AZURE_URL -u $AZURE_UID -p $AZURE_PWD --insecure-skip-tls-verify=true
oc project $PROJECT
#skupper service unbind rtgs-apis service rtgs-apis-rhsi
skupper service unbind postgresql service postgresqldb
menu_array["11"]="\033[43m11) unbind service\033[0m"
menu_array["7"]="7) bind service"
;;

"12")
# unbind Azure Native DB
oc login --server=$DC_URL -u $DC_UID -p $DC_PWD --insecure-skip-tls-verify=true
oc project azure-native
skupper service unbind postgresql service azure-postgresql-service
menu_array["12"]="\033[43m12) unbind service\033[0m"
menu_array["8"]="8) bind service"
;;



"l")
# Link All
if [[ $AWS_STATUS == "on" ]] 
then
  echo "---- AWS ----"
  oc login --server=$AWS_URL -u $AWS_UID -p $AWS_PWD --insecure-skip-tls-verify=true
  oc project $PROJECT
  skupper link create aws_to_dc.token --name aws-to-dc
fi

if [[ $AZURE_STATUS == "on" ]] 
then
  echo "---- AZURE ----"
  oc login --server=$AZURE_URL -u $AZURE_UID -p $AZURE_PWD --insecure-skip-tls-verify=true
  oc project $PROJECT
  skupper link create azure_to_dc.token --name azure-to-dc
fi

if [[ $AZURE_NATIVE_STATUS == "on" ]] 
then
  echo "---- AZURE-NATIVE ----"
  oc login --server=$DC_URL -u $DC_UID -p $DC_PWD --insecure-skip-tls-verify=true
  oc project azure-native
  skupper link create azure_native_to_dc.token --name azure-native-to-dc
fi  
;;


"e")
# DC : Expose db service
# Make sure you remove local svc for postgresql and rtgs-apis
oc login --server=$DC_URL -u $DC_UID -p $DC_PWD --insecure-skip-tls-verify=true
oc project $PROJECT
skupper service create postgresql 5432 --protocol tcp
#skupper service create rtgs-apis 8080 --protocol http
;;

"d")
if [[ $DC_STATUS == "on" ]] 
then
  oc login --server=$DC_URL -u $DC_UID -p $DC_PWD --insecure-skip-tls-verify=true
  oc project $PROJECT
  skupper delete
fi

if [[ $AWS_STATUS == "on" ]] 
then
  oc login --server=$AWS_URL -u $AWS_UID -p $AWS_PWD --insecure-skip-tls-verify=true
  oc project $PROJECT
  skupper delete
fi

if [[ $AZURE_STATUS == "on" ]] 
then
  oc login --server=$AZURE_URL -u $AZURE_UID -p $AZURE_PWD --insecure-skip-tls-verify=true
  oc project $PROJECT
  skupper delete
fi

if [[ $AZURE_NATIVE_STATUS == "on" ]] 
then
  oc login --server=$DC_URL -u $DC_UID -p $DC_PWD --insecure-skip-tls-verify=true
  oc project azure-native
  skupper delete
fi

;;



"c1")
MSG="[c1] Business continuity policies and disaster recovery plans as a C-level responsibility"
;;
"c2")
MSG="[c2] Harmonization of mandatory incident reporting frameworks (e.g. GDPR, NIS, eIDAs, SSM, PSD2)"
;;
"c3")
MSG="[c3] At least annually, including remediation plans with ICT third party providers direct involvement"
;;
"c4")
MSG="[c4] Critical ICT Third-Parties subject to an EU oversight framework under a financial European Supervisory Authority"
;;
"c5")
MSG="[c5] Voluntary exchange of threat information & Intelligence are allowed and supported"
;;

esac

#RESULT="\033[43m step $n is done\033[0m"
RESULT="\033[4m\033[1;37mstep $n is done\033[0m"
menu "done" $n

done
